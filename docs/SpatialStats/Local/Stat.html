<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SpatialStats::Local::Stat
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "SpatialStats::Local::Stat";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../SpatialStats.html" title="SpatialStats (module)">SpatialStats</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Local.html" title="SpatialStats::Local (module)">Local</a></span></span>
     &raquo; 
    <span class="title">Stat</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SpatialStats::Local::Stat
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">SpatialStats::Local::Stat</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/spatial_stats/local/stat.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Stat is the abstract base class for local stats. It defines the methods that are common between all classes and will raise a NotImplementedError on those that are specific for each type of statistic.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="BivariateMoran.html" title="SpatialStats::Local::BivariateMoran (class)">BivariateMoran</a></span>, <span class='object_link'><a href="Geary.html" title="SpatialStats::Local::Geary (class)">Geary</a></span>, <span class='object_link'><a href="GetisOrd.html" title="SpatialStats::Local::GetisOrd (class)">GetisOrd</a></span>, <span class='object_link'><a href="Moran.html" title="SpatialStats::Local::Moran (class)">Moran</a></span>, <span class='object_link'><a href="MultivariateGeary.html" title="SpatialStats::Local::MultivariateGeary (class)">MultivariateGeary</a></span></p>
</div>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#field-instance_method" title="#field (instance method)">#<strong>field</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute field.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#scope-instance_method" title="#scope (instance method)">#<strong>scope</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute scope.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#weights-instance_method" title="#weights (instance method)">#<strong>weights</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute weights.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#crand-instance_method" title="#crand (instance method)">#<strong>crand</strong>(permutations, rng)  &#x21d2; Numo::Int32 </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Conditional randomization algorithm used in permutation testing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expectation-instance_method" title="#expectation (instance method)">#<strong>expectation</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(scope, field, weights)  &#x21d2; Stat </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Base class for local stats.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mc-instance_method" title="#mc (instance method)">#<strong>mc</strong>(permutations = 99, seed = nil)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Permutation test to determine a pseudo p-values of the <code>#stat</code> method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mc_bv-instance_method" title="#mc_bv (instance method)">#<strong>mc_bv</strong>(permutations, seed)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Permutation test to determine a pseudo p-values of the <code>#stat</code> method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#quads-instance_method" title="#quads (instance method)">#<strong>quads</strong>  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determines what quadrant an observation is in.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stat-instance_method" title="#stat (instance method)">#<strong>stat</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#summary-instance_method" title="#summary (instance method)">#<strong>summary</strong>(permutations = 99, seed = nil)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Summary of the statistic.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#variance-instance_method" title="#variance (instance method)">#<strong>variance</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#x=-instance_method" title="#x= (instance method)">#<strong>x=</strong>(values)  &#x21d2; Object </a>
    

    
      (also: #z=)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#y=-instance_method" title="#y= (instance method)">#<strong>y=</strong>(values)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#z_score-instance_method" title="#z_score (instance method)">#<strong>z_score</strong>  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Z-score for each observation of the statistic.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(scope, field, weights)  &#x21d2; <tt><span class='object_link'><a href="" title="SpatialStats::Local::Stat (class)">Stat</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Base class for local stats</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_weights'>weights</span><span class='rparen'>)</span>
  <span class='ivar'>@scope</span> <span class='op'>=</span> <span class='id identifier rubyid_scope'>scope</span>
  <span class='ivar'>@field</span> <span class='op'>=</span> <span class='id identifier rubyid_field'>field</span>
  <span class='ivar'>@weights</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_standardize'>standardize</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="field=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="field-instance_method">
  
    #<strong>field</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute field.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_field'>field</span>
  <span class='ivar'>@field</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="scope=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="scope-instance_method">
  
    #<strong>scope</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute scope.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scope'>scope</span>
  <span class='ivar'>@scope</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="weights=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="weights-instance_method">
  
    #<strong>weights</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute weights.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_weights'>weights</span>
  <span class='ivar'>@weights</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="crand-instance_method">
  
    #<strong>crand</strong>(permutations, rng)  &#x21d2; <tt>Numo::Int32</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Conditional randomization algorithm used in permutation testing. Returns a matrix with permuted index values that will be used for selecting values from the original data set.</p>

<p>The width of the matrix is the max number of neighbors + 1 which is way less than it would be if the original vector was shuffled in full.</p>

<p>This is super important because most weight matrices are very sparse so the amount of shuffling/multiplication that is done is reduced drastically.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::Int32</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>matrix of shape perms x wc_max + 1</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://github.com/pysal/esda/blob/master/esda/moran.py#L893" target="_parent" title="https://github.com/pysal/esda/blob/master/esda/moran.py#L893">https://github.com/pysal/esda/blob/master/esda/moran.py#L893</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 69</span>

<span class='kw'>def</span> <span class='id identifier rubyid_crand'>crand</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span><span class='comma'>,</span> <span class='id identifier rubyid_rng'>rng</span><span class='rparen'>)</span>
  <span class='comment'># basing this off the ESDA method
</span>  <span class='comment'># need to get k for max_neighbors
</span>  <span class='comment'># and wc for cardinalities of each item
</span>  <span class='comment'># this returns an array of length n with
</span>  <span class='comment'># (permutations x neighbors) Numo Arrays.
</span>  <span class='comment'># This helps reduce computation time because
</span>  <span class='comment'># we are only dealing with neighbors for each
</span>  <span class='comment'># entry not the entire list of permutations for each entry.
</span>  <span class='id identifier rubyid_n_1'>n_1</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span>

  <span class='comment'># weight counts
</span>  <span class='id identifier rubyid_wc'>wc</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_wc'>wc</span>
  <span class='id identifier rubyid_k'>k</span> <span class='op'>=</span> <span class='id identifier rubyid_wc'>wc</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_prange'>prange</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_permutations'>permutations</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

  <span class='id identifier rubyid_ids_perm'>ids_perm</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_n_1'>n_1</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>Int32</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_prange'>prange</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_ids_perm'>ids_perm</span><span class='period'>.</span><span class='id identifier rubyid_sample'>sample</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='label'>random:</span> <span class='id identifier rubyid_rng'>rng</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="expectation-instance_method">
  
    #<strong>expectation</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_expectation'>expectation</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method expectation not implemented</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mc-instance_method">
  
    #<strong>mc</strong>(permutations = 99, seed = nil)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Permutation test to determine a pseudo p-values of the <code>#stat</code> method. Shuffles x values, recomputes <code>#stat</code> for each variation, then compares to the computed one. The ratio of more extreme values to permutations is returned for each observation.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>permutations</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>99</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>to run. Last digit should be 9 to produce round numbers.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>seed</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>used in random number generator for shuffles.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of p-values</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://geodacenter.github.io/glossary.html#perm" target="_parent" title="https://geodacenter.github.io/glossary.html#perm">https://geodacenter.github.io/glossary.html#perm</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mc'>mc</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span> <span class='op'>=</span> <span class='int'>99</span><span class='comma'>,</span> <span class='id identifier rubyid_seed'>seed</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># For local tests, we need to shuffle the values
</span>  <span class='comment'># but for each item, hold its value in place and shuffle
</span>  <span class='comment'># its neighbors. Then we will only test for that item instead
</span>  <span class='comment'># of the entire set. This will be done for each item.
</span>  <span class='id identifier rubyid_rng'>rng</span> <span class='op'>=</span> <span class='id identifier rubyid_gen_rng'>gen_rng</span><span class='lparen'>(</span><span class='id identifier rubyid_seed'>seed</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rids'>rids</span> <span class='op'>=</span> <span class='id identifier rubyid_crand'>crand</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span><span class='comma'>,</span> <span class='id identifier rubyid_rng'>rng</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_n_1'>n_1</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_sparse'>sparse</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_sparse'>sparse</span>
  <span class='id identifier rubyid_row_index'>row_index</span> <span class='op'>=</span> <span class='id identifier rubyid_sparse'>sparse</span><span class='period'>.</span><span class='id identifier rubyid_row_index'>row_index</span>
  <span class='id identifier rubyid_ws'>ws</span> <span class='op'>=</span> <span class='id identifier rubyid_sparse'>sparse</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
  <span class='id identifier rubyid_wc'>wc</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_wc'>wc</span>
  <span class='id identifier rubyid_stat_orig'>stat_orig</span> <span class='op'>=</span> <span class='id identifier rubyid_stat'>stat</span>

  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_n_1'>n_1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='id identifier rubyid_observations'>observations</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_n_1'>n_1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
    <span class='id identifier rubyid_idsi'>idsi</span> <span class='op'>=</span> <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_idsi'>idsi</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_idsi'>idsi</span><span class='period'>.</span><span class='id identifier rubyid_shuffle!'>shuffle!</span><span class='lparen'>(</span><span class='label'>random:</span> <span class='id identifier rubyid_rng'>rng</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_idsi'>idsi</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>Int32</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_idsi'>idsi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sample'>sample</span> <span class='op'>=</span> <span class='id identifier rubyid_arr'>arr</span><span class='lbracket'>[</span><span class='id identifier rubyid_idsi'>idsi</span><span class='lbracket'>[</span><span class='id identifier rubyid_rids'>rids</span><span class='lbracket'>[</span><span class='kw'>true</span><span class='comma'>,</span> <span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_wc'>wc</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbracket'>]</span>

    <span class='comment'># account for case where there are no neighbors
</span>    <span class='id identifier rubyid_row_range'>row_range</span> <span class='op'>=</span> <span class='id identifier rubyid_row_index'>row_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span><span class='op'>..</span><span class='lparen'>(</span><span class='id identifier rubyid_row_index'>row_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_row_range'>row_range</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='id identifier rubyid_observations'>observations</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_permutations'>permutations</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_wi'>wi</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_ws'>ws</span><span class='lbracket'>[</span><span class='id identifier rubyid_row_range'>row_range</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stat_i_new'>stat_i_new</span> <span class='op'>=</span> <span class='id identifier rubyid_mc_i'>mc_i</span><span class='lparen'>(</span><span class='id identifier rubyid_wi'>wi</span><span class='comma'>,</span> <span class='id identifier rubyid_sample'>sample</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stat_i_orig'>stat_i_orig</span> <span class='op'>=</span> <span class='id identifier rubyid_stat_orig'>stat_orig</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_observations'>observations</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mc_observation_calc'>mc_observation_calc</span><span class='lparen'>(</span><span class='id identifier rubyid_stat_i_orig'>stat_i_orig</span><span class='comma'>,</span> <span class='id identifier rubyid_stat_i_new'>stat_i_new</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_permutations'>permutations</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_observations'>observations</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ri'>ri</span><span class='op'>|</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_ri'>ri</span> <span class='op'>+</span> <span class='float'>1.0</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span> <span class='op'>+</span> <span class='float'>1.0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mc_bv-instance_method">
  
    #<strong>mc_bv</strong>(permutations, seed)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Permutation test to determine a pseudo p-values of the <code>#stat</code> method. Shuffles y values, hold x values, recomputes <code>#stat</code> for each variation, then compares to the computed one. The ratio of more extreme values to permutations is returned for each observation.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>permutations</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>to run. Last digit should be 9 to produce round numbers.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>seed</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>used in random number generator for shuffles.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of p-values</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://geodacenter.github.io/glossary.html#perm" target="_parent" title="https://geodacenter.github.io/glossary.html#perm">https://geodacenter.github.io/glossary.html#perm</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 157</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mc_bv'>mc_bv</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span><span class='comma'>,</span> <span class='id identifier rubyid_seed'>seed</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rng'>rng</span> <span class='op'>=</span> <span class='id identifier rubyid_gen_rng'>gen_rng</span><span class='lparen'>(</span><span class='id identifier rubyid_seed'>seed</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rids'>rids</span> <span class='op'>=</span> <span class='id identifier rubyid_crand'>crand</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span><span class='comma'>,</span> <span class='id identifier rubyid_rng'>rng</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_n_1'>n_1</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_sparse'>sparse</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_sparse'>sparse</span>
  <span class='id identifier rubyid_row_index'>row_index</span> <span class='op'>=</span> <span class='id identifier rubyid_sparse'>sparse</span><span class='period'>.</span><span class='id identifier rubyid_row_index'>row_index</span>
  <span class='id identifier rubyid_ws'>ws</span> <span class='op'>=</span> <span class='id identifier rubyid_sparse'>sparse</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
  <span class='id identifier rubyid_wc'>wc</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_wc'>wc</span>
  <span class='id identifier rubyid_stat_orig'>stat_orig</span> <span class='op'>=</span> <span class='id identifier rubyid_stat'>stat</span>

  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_n_1'>n_1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='id identifier rubyid_observations'>observations</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_n_1'>n_1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
    <span class='id identifier rubyid_idsi'>idsi</span> <span class='op'>=</span> <span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_idsi'>idsi</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_idsi'>idsi</span><span class='period'>.</span><span class='id identifier rubyid_shuffle!'>shuffle!</span><span class='lparen'>(</span><span class='label'>random:</span> <span class='id identifier rubyid_rng'>rng</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_idsi'>idsi</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>Int32</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_idsi'>idsi</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sample'>sample</span> <span class='op'>=</span> <span class='id identifier rubyid_arr'>arr</span><span class='lbracket'>[</span><span class='id identifier rubyid_idsi'>idsi</span><span class='lbracket'>[</span><span class='id identifier rubyid_rids'>rids</span><span class='lbracket'>[</span><span class='kw'>true</span><span class='comma'>,</span> <span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_wc'>wc</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbracket'>]</span>

    <span class='comment'># account for case where there are no neighbors
</span>    <span class='id identifier rubyid_row_range'>row_range</span> <span class='op'>=</span> <span class='id identifier rubyid_row_index'>row_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span><span class='op'>..</span><span class='lparen'>(</span><span class='id identifier rubyid_row_index'>row_index</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_row_range'>row_range</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='id identifier rubyid_observations'>observations</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_permutations'>permutations</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_wi'>wi</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Numo.html" title="Numo (module)">Numo</a></span></span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_ws'>ws</span><span class='lbracket'>[</span><span class='id identifier rubyid_row_range'>row_range</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stat_i_new'>stat_i_new</span> <span class='op'>=</span> <span class='id identifier rubyid_mc_i'>mc_i</span><span class='lparen'>(</span><span class='id identifier rubyid_wi'>wi</span><span class='comma'>,</span> <span class='id identifier rubyid_sample'>sample</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stat_i_orig'>stat_i_orig</span> <span class='op'>=</span> <span class='id identifier rubyid_stat_orig'>stat_orig</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_observations'>observations</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mc_observation_calc'>mc_observation_calc</span><span class='lparen'>(</span><span class='id identifier rubyid_stat_i_orig'>stat_i_orig</span><span class='comma'>,</span> <span class='id identifier rubyid_stat_i_new'>stat_i_new</span><span class='comma'>,</span>
                                            <span class='id identifier rubyid_permutations'>permutations</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_observations'>observations</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ri'>ri</span><span class='op'>|</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_ri'>ri</span> <span class='op'>+</span> <span class='float'>1.0</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span> <span class='op'>+</span> <span class='float'>1.0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="quads-instance_method">
  
    #<strong>quads</strong>  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determines what quadrant an observation is in. Based on its value compared to its neighbors. This does not work for all stats, since it requires that values be negative.</p>

<p>In a standardized array of z, high values are values greater than 0 and it&#39;s neighbors are determined by the spatial lag and if that is positive then it&#39;s neighbors would be high, low otherwise.</p>

<p>Quadrants are:</p>
<dl class="rdoc-list label-list"><dt>HH
<dd>
<p>a high value surrounded by other high values</p>
</dd><dt>LH
<dd>
<p>a low value surrounded by high values</p>
</dd><dt>LL
<dd>
<p>a low value surrounded by low values</p>
</dd><dt>HL
<dd>
<p>a high value surrounded by low values</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of labels</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 213</span>

<span class='kw'>def</span> <span class='id identifier rubyid_quads'>quads</span>
  <span class='comment'># https://github.com/pysal/esda/blob/master/esda/moran.py#L925
</span>  <span class='id identifier rubyid_z_lag'>z_lag</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../SpatialStats.html" title="SpatialStats (module)">SpatialStats</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Utils.html" title="SpatialStats::Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Utils/Lag.html" title="SpatialStats::Utils::Lag (module)">Lag</a></span></span><span class='period'>.</span><span class='id identifier rubyid_neighbor_average'><span class='object_link'><a href="../Utils/Lag.html#neighbor_average-class_method" title="SpatialStats::Utils::Lag.neighbor_average (method)">neighbor_average</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_weights'>weights</span><span class='comma'>,</span> <span class='id identifier rubyid_z'>z</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_zp'>zp</span> <span class='op'>=</span> <span class='id identifier rubyid_z'>z</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:positive?</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lp'>lp</span> <span class='op'>=</span> <span class='id identifier rubyid_z_lag'>z_lag</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:positive?</span><span class='rparen'>)</span>

  <span class='comment'># hh = zp &amp; lp
</span>  <span class='comment'># lh = zp ^ true &amp; lp
</span>  <span class='comment'># ll = zp ^ true &amp; lp ^ true
</span>  <span class='comment'># hl = zp next to lp ^ true
</span>  <span class='id identifier rubyid_hh'>hh</span> <span class='op'>=</span> <span class='id identifier rubyid_zp'>zp</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_lp'>lp</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_lh'>lh</span> <span class='op'>=</span> <span class='id identifier rubyid_zp'>zp</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span> <span class='op'>^</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_lp'>lp</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ll'>ll</span> <span class='op'>=</span> <span class='id identifier rubyid_zp'>zp</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span> <span class='op'>^</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_lp'>lp</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>^</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_hl'>hl</span> <span class='op'>=</span> <span class='id identifier rubyid_zp'>zp</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_lp'>lp</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>^</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='comment'># now zip lists and map them to proper terms
</span>  <span class='id identifier rubyid_quad_terms'>quad_terms</span> <span class='op'>=</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>HH</span><span class='words_sep'> </span><span class='tstring_content'>LH</span><span class='words_sep'> </span><span class='tstring_content'>LL</span><span class='words_sep'> </span><span class='tstring_content'>HL</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_hh'>hh</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_lh'>lh</span><span class='comma'>,</span> <span class='id identifier rubyid_ll'>ll</span><span class='comma'>,</span> <span class='id identifier rubyid_hl'>hl</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_feature'>feature</span><span class='op'>|</span>
    <span class='id identifier rubyid_quad_terms'>quad_terms</span><span class='lbracket'>[</span><span class='id identifier rubyid_feature'>feature</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stat-instance_method">
  
    #<strong>stat</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stat'>stat</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method stat not defined</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="summary-instance_method">
  
    #<strong>summary</strong>(permutations = 99, seed = nil)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Summary of the statistic. Computes <code>stat</code>, <code>mc</code>, and <code>groups</code> then returns the values in a hash array.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>permutations</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>99</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>to run. Last digit should be 9 to produce round numbers.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>seed</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>used in random number generator for shuffles.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


243
244
245
246
247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 243</span>

<span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span> <span class='op'>=</span> <span class='int'>99</span><span class='comma'>,</span> <span class='id identifier rubyid_seed'>seed</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_p_vals'>p_vals</span> <span class='op'>=</span> <span class='id identifier rubyid_mc'>mc</span><span class='lparen'>(</span><span class='id identifier rubyid_permutations'>permutations</span><span class='comma'>,</span> <span class='id identifier rubyid_seed'>seed</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_stat'>stat</span><span class='comma'>,</span> <span class='id identifier rubyid_p_vals'>p_vals</span><span class='comma'>,</span> <span class='id identifier rubyid_groups'>groups</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='lbrace'>{</span> <span class='label'>key:</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>stat:</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>p:</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>group:</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="variance-instance_method">
  
    #<strong>variance</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_variance'>variance</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method variance not implemented</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="x=-instance_method">
  
    #<strong>x=</strong>(values)  &#x21d2; <tt>Object</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='z=-instance_method'>z=</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_x='>x=</span><span class='lparen'>(</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='ivar'>@x</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_standardize'>standardize</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="y=-instance_method">
  
    #<strong>y=</strong>(values)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_y='>y=</span><span class='lparen'>(</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='ivar'>@y</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_standardize'>standardize</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="z_score-instance_method">
  
    #<strong>z_score</strong>  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Z-score for each observation of the statistic.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>of the number of deviations from the mean</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spatial_stats/local/stat.rb', line 44</span>

<span class='kw'>def</span> <span class='id identifier rubyid_z_score'>z_score</span>
  <span class='id identifier rubyid_numerators'>numerators</span> <span class='op'>=</span> <span class='id identifier rubyid_stat'>stat</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>-</span> <span class='id identifier rubyid_expectation'>expectation</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_denominators'>denominators</span> <span class='op'>=</span> <span class='id identifier rubyid_variance'>variance</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_numerators'>numerators</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_numerator'>numerator</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
    <span class='id identifier rubyid_numerator'>numerator</span> <span class='op'>/</span> <span class='id identifier rubyid_denominators'>denominators</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat May 23 09:26:30 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.6.3).
</div>

    </div>
  </body>
</html>